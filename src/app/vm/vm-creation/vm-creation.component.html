<div class="overlay" *ngIf="sgCreationInProgress">
  <div class="message">
    <p *ngIf="sgCreationInProgress">{{ 'CREATING_SG' | translate }}</p>
    <p *ngIf="agCreationInProgress">{{ 'CREATING_AG' | translate }}</p>
    <mdl-progress [indeterminate]="sgCreationInProgress || agCreationInProgress"></mdl-progress>
  </div>
</div>
<div class="vm-creation-container">
  <h3 class="mdl-dialog__title">{{ 'NEW_VM' | translate }}</h3>
  <form
    (ngSubmit)="onVmCreationSubmit($event)"
    [formGroup]="form"
    #vmCreateForm="ngForm"
    *loading="fetching"
    novalidate
  >
    <div class="container">
      <div class="left-column">
        <h5>{{ 'VM_CREATION_FORM.NAME' | translate }}</h5>
        <div>
          <mdl-textfield
            type="text"
            [label]="'VM_CREATION_FORM.NAME' | translate"
            name="name"
            pattern="^[a-zA-Z]{1}[a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]$"
            [error-msg]="(takenName ? 'THIS_NAME_IS_TAKEN' : '') | translate"
            #vmname="ngModel"
            [(ngModel)]="vmCreationState.displayName"
            [class.is-invalid]="!vmname.valid || (vmCreationState.displayName === takenName)"
          >
          </mdl-textfield>
        </div>

        <div>
          <h5>{{ 'VM_CREATION_FORM.ZONE' | translate }}</h5>
          <div>
            <mdl-select
              [(ngModel)]="zoneId"
              name="zone"
            >
              <mdl-option *ngFor="let z of vmCreationData.zones" [value]="z.id" >
                {{ z.name }}
              </mdl-option>
            </mdl-select>
          </div>
        </div>

        <div *ngIf="zoneId && vmCreationData.serviceOfferings">
          <h5>{{ 'VM_CREATION_FORM.SERVICE_OFFERING' | translate }}</h5>
          <cs-service-offering-selector
            name="serviceOffering"
            [serviceOfferings]="vmCreationData.serviceOfferings"
            [zoneId]="vmCreationState?.zone?.id"
            [(ngModel)]="serviceOffering"
          ></cs-service-offering-selector>
        </div>

        <div class="dialog-select-wrapper">
          <h5 class="dialog-select-header">{{ 'VM_CREATION_FORM.INSTALLATION_SOURCE' | translate }}</h5>
          <cs-vm-creation-template
            *ngIf="vmCreationData.vm.template && templates && isos"
            name="template"
            class="dialog-select-select template-select"
            [templates]="templates"
            [isos]="isos"
            [zoneId]="zoneId"
            [ngModel]="vmCreationData.vm.template"
            (ngModelChange)="setTemplate($event)"
          ></cs-vm-creation-template>
        </div>

        <div *ngIf="!templateSelected && diskOfferings">
          <h5>{{ 'DISK_OFFERING' | translate }}</h5>
          <cs-disk-offering
            name="diskOfferingSelector"
            [diskOfferingList]="vmCreationData.diskOfferings"
            [(ngModel)]="diskOffering"
          ></cs-disk-offering>
        </div>
        <cs-slider
          *ngIf="templateSelected || showRootDiskResize"
          [min]="vmCreationState.rootDiskSizeMin"
          [max]="vmCreationData.rootDiskSizeLimit"
          [label]="'VM_CREATION_FORM.DISK_SIZE' | translate"
          name="rds"
          [(ngModel)]="vmCreationState.rootDiskSize"
          [units]="'GB' | translate"
        ></cs-slider>
      </div>
      <div class="right-column">
        <h5>{{ 'VM_CREATION_FORM.GROUP' | translate }}</h5>
        <div *ngIf="vmCreationData.instanceGroups">
          <mdl-autocomplete
            *ngIf="vmCreationData.instanceGroups"
            name="group"
            [placeholder]="'NO_GROUP' | translate"
            [options]="vmCreationData.instanceGroups"
            [(ngModel)]="affinityGroup"
          ></mdl-autocomplete>
        </div>

        <h5>{{ 'VM_CREATION_FORM.AFFINITY_GROUPS' | translate }}</h5>
        <div *ngIf="noAffinityGroupTranslation">
          <mdl-autocomplete
            name="affinityGroup"
            [placeholder]="'NO_GROUP' | translate"
            [options]="vmCreationData.affinityGroupNames"
            [(ngModel)]="instanceGroup"
          ></mdl-autocomplete>
        </div>
        <cs-security-group-rules-manager
          *ngIf="showSecurityGroups"
          name="sgm"
          class="sg-rules-manager"
          [(ngModel)]="securityRules"
        ></cs-security-group-rules-manager>

        {{ keyboard | json }}
        <h5>{{ 'VM_CREATION_FORM.KEYBOARD_LAYOUT' | translate }}</h5>
        <cs-keyboards
          name="keyboard"
          *ngIf="vmCreationData"
          [(ngModel)]="vmCreationState.keyboard"
        ></cs-keyboards>

        <h5>{{ 'VM_CREATION_FORM.SSH_KEYPAIR' | translate }}</h5>
        <div>
          <mdl-select
            name="ssh"
            [(ngModel)]="vmCreationState.keyPair"
          >
            <mdl-option
              *ngFor="let k of vmCreationData.sshKeyPairs"
              [value]="k.name"
            >
              {{ k.name }}
            </mdl-option>
          </mdl-select>
        </div>
        <div class="start-vm-checkbox">
          <mdl-checkbox
            name="startVm"
            [(ngModel)]="vmCreationState.doStartVm"
          >
            {{ 'VM_CREATION_FORM.START_VM' | translate }}
          </mdl-checkbox>
        </div>
      </div>
      <div *ngIf="!enoughResources">
        {{ 'INSUFFICIENT_RESOURCES_VM' | translate }}
        <div *ngIf="insufficientResources.length">
          {{ 'VM_CREATION_FORM.YOU_RAN_OUT_OF' | translate }}
          <ng-container *ngFor="let resource of insufficientResources; let l = last">
            {{ insufficientResourcesErrorMap[resource] | translate }}<ng-container *ngIf="!l">,</ng-container>
          </ng-container>
        </div>
      </div>
    </div>
    <div class="mdl-dialog__actions">
      <button
        mdl-colored="primary"
        [disabled]="!vmCreateForm.valid || (vmCreationState.displayName === takenName)"
        type="submit"
        mdl-button
        mdl-ripple
      >
        {{ 'CREATE' | translate }}
      </button>
      <button
        mdl-colored="primary"
        type="button"
        mdl-button
        (click)="onCancel()"
        mdl-ripple
      >
        {{ 'CANCEL' | translate }}
      </button>
    </div>
  </form>
</div>
